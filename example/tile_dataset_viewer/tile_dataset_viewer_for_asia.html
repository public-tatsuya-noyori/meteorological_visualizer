<!doctype html>
<html>
<head>
<meta charset='UTF-8'>
<title>tile dataset viewer</title>
<link href='https://unpkg.com/@finos/perspective-viewer@1.0.7/dist/umd/material-dense.css' rel='stylesheet'/>
<!-- <link href='https://cdn.jsdelivr.net/npm/@finos/perspective-viewer@1.0.7/dist/umd/material-dense.css' rel='stylesheet'/> -->
<script src='https://unpkg.com/@finos/perspective@1.0.7/dist/umd/perspective.js'></script>
<!-- <script src='https://cdn.jsdelivr.net/npm/@finos/perspective@1.0.7/dist/umd/perspective.js'></script> -->
<script src='https://unpkg.com/@finos/perspective-viewer@1.0.7/dist/umd/perspective-viewer.js'></script>
<!-- <script src='https://cdn.jsdelivr.net/npm/@finos/perspective-viewer@1.0.7/dist/umd/perspective-viewer.js'></script> -->
<script src='https://unpkg.com/@finos/perspective-viewer-datagrid@1.0.7/dist/umd/perspective-viewer-datagrid.js'></script>
<!-- <script src='https://cdn.jsdelivr.net/npm/@finos/perspective-viewer-datagrid@1.0.7/dist/umd/perspective-viewer-datagrid.js'></script> -->
<script src='https://unpkg.com/@finos/perspective-viewer-d3fc@1.0.7/dist/umd/perspective-viewer-d3fc.js'></script>
<!-- <script src='https://cdn.jsdelivr.net/npm/@finos/perspective-viewer-d3fc@1.0.7/dist/umd/perspective-viewer-d3fc.js'></script> -->
<script src='https://unpkg.com/deck.gl@8.6.5/dist.min.js'></script>
<!-- <script src='https://cdn.jsdelivr.net/npm/deck.gl@8.6.5/dist.min.js'></script> -->
<script src='https://unpkg.com/aws-sdk@2.1037.0/dist/aws-sdk.min.js'></script>
<!-- <script src='https://cdn.jsdelivr.net/npm/aws-sdk@2.1037.0/dist/aws-sdk.min.js'></script> -->
<script src='https://unpkg.com/d3@7.1.1/dist/d3.min.js'></script>
<!-- <script src='https://cdn.jsdelivr.net/npm/d3@7.1.1/dist/d3.min.js'></script> -->
<script src='https://unpkg.com/apache-arrow@6.0.1/Arrow.es2015.min.js'></script>
<!-- <script src='https://cdn.jsdelivr.net/npm/apache-arrow@6.0.1/Arrow.es2015.min.js'></script> -->
<script type='module' src='./js/tile_dataset_viewer.js'></script>
<script>
const mapGeoJsonLayer = new deck.GeoJsonLayer({data:'js/ne_110m_coastline.json',stroked:true,filled:true,lineWidthMinPixels:2,opacity:0.4,getLineColor:[60, 60, 60],getFillColor:[200, 200, 200]});
const endpoint = 'http://202.32.195.138:9000/', bucket = 'aa-open-dataset';
const mapViewInitialViewState = {latitude:0.0,longitude:0.0,zoom:0,bearing:0,pitch:0};
//const mapViewInitialViewState = {latitude:0.0,longitude:90.0,zoom:0,bearing:0,pitch:0};
const globeViewInitialViewState = {latitude:0.0,longitude:0.0,zoom:0,bearing:0,pitch:0};
//const globeViewInitialViewState = {latitude:0.0,longitude:90.0,zoom:0,bearing:0,pitch:0};
const s3 = new AWS.S3({endpoint: new AWS.Endpoint(endpoint), s3ForcePathStyle: true});
const numberOfConfigDeckglViewersTableTd = 2;
let datasetCategoryPathConfigMap = new Map();
let categoryPath, name, height, stepValueForColor, numberOfStepForColor, startColor, hslHueAngle, configTable;
//let filter = [];
let filter = ['l1x2y0', 'l1x2y1', 'l1x3y0', 'l1x3y1', 
              'l2x5y0', 'l2x6y0', 'l2x7y0', 'l2x5y1', 'l2x6y1', 'l2x7y1', 'l2x5y2', 'l2x6y2', 'l2x7y2',
              'l3x9y1', 'l3x10y1', 'l3x11y1', 'l3x12y1', 'l3x13y1', 'l3x14y1',
              'l3x9y2', 'l3x10y2', 'l3x11y2', 'l3x12y2', 'l3x13y2', 'l3x14y2',
              'l3x9y3', 'l3x10y3', 'l3x11y3', 'l3x12y3', 'l3x13y3', 'l3x14y3'];

categoryPath = 'bufr_to_arrow/ocean/float/';
height = ['water pressure [Pa]'];
name = ['water pressure [Pa]'];
stepValueForColor = [1000000.0];
numberOfStepForColor = [20];
startValueForColor = [0.0];
startColor = ['blue'];
hslHueAngle = [-300];
datasetCategoryPathConfigMap.set(categoryPath, {name:name, filter:filter, height:height, stepValueForColor:stepValueForColor, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/surface/buoy/';
height = [];
name = ['pressure reduced to mean sea level [Pa]', 'oceanographic water temperature [K]', 'wind speed [m s-1]', 'wind direction [degree]'];
stepValueForColor = [-400.0, 1.0, 1.0, 10.0];
numberOfStepForColor = [30, 40, 30, 36];
startValueForColor = [104000.0, 263.15, 0.0, 0.0];
startColor = ['blue', 'blue', 'blue', 'red'];
hslHueAngle = [-300, -300, -300, -360];
datasetCategoryPathConfigMap.set(categoryPath, {name:name, filter:filter, height:height, stepValueForColor:stepValueForColor, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/surface/gps_station/';
height = ['height of station [m]'];
name = ['atmospheric path delay in satellite signal [m]'];
stepValueForColor = [0.05];
numberOfStepForColor = [40];
startValueForColor = [1.0];
startColor = ['blue'];
hslHueAngle = [-300];
datasetCategoryPathConfigMap.set(categoryPath, {name:name, filter:filter, height:height, stepValueForColor:stepValueForColor, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/surface/ship/';
height = [];
name = ['pressure reduced to mean sea level [Pa]', 'air temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]', 'wind direction [degree]'];
stepValueForColor = [-400.0, 1.0, 1.0, 1.0, 10.0];
numberOfStepForColor = [30, 40, 40, 30, 36];
startValueForColor = [104000.0, 263.15, 263.15, 0.0, 0.0];
startColor = ['blue', 'blue', 'blue', 'blue', 'red'];
hslHueAngle = [-300, -300, -300, -300, -360];
datasetCategoryPathConfigMap.set(categoryPath, {name:name, filter:filter, height:height, stepValueForColor:stepValueForColor, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/surface/weather_station/';
height = ['height of station [m]'];
name = ['pressure reduced to mean sea level [Pa]', 'air temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]', 'wind direction [degree]'];
stepValueForColor = [-400.0, 1.0, 1.0, 1.0, 10.0];
numberOfStepForColor = [30, 40, 40, 30, 36];
startValueForColor = [104000.0, 263.15, 263.15, 0.0, 0.0];
startColor = ['blue', 'blue', 'blue', 'blue', 'red'];
hslHueAngle = [-300, -300, -300, -300, -360];
datasetCategoryPathConfigMap.set(categoryPath, {name:name, filter:filter, height:height, stepValueForColor:stepValueForColor, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/upper_air/aircraft/';
height = ['flight level [m]' , 'height [m]'];
name = ['flight level [m]', 'air temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]', 'wind direction [degree]'];
stepValueForColor = [400.0, 1.0, 1.0, 1.0, 10.0];
numberOfStepForColor = [40, 40, 40, 30, 36];
startValueForColor = [400.0, 263.15, 263.15, 0.0, 0.0];
startColor = ['blue', 'blue', 'blue', 'blue', 'red'];
hslHueAngle = [-300, -300, -300, -300, -360];
datasetCategoryPathConfigMap.set(categoryPath, {name:name, filter:filter, height:height, stepValueForColor:stepValueForColor, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/upper_air/profiler/';
height = ['height [m]'];
name = ['height [m]', 'virtual temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]', 'wind direction [degree]'];
stepValueForColor = [400.0, 1.0, 1.0, 1.0, 10.0];
numberOfStepForColor = [40, 40, 40, 30, 36];
startValueForColor = [400.0, 263.15, 263.15, 0.0, 0.0];
startColor = ['blue', 'blue', 'blue', 'blue', 'red'];
hslHueAngle = [-300, -300, -300, -300, -360];
datasetCategoryPathConfigMap.set(categoryPath, {name:name, filter:filter, height:height, stepValueForColor:stepValueForColor, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/upper_air/sonde/';
height = ['geopotential height [m]'];
name = ['pressure [Pa]', 'air temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]', 'wind direction [degree]'];
stepValueForColor = [-400.0, 1.0, 1.0, 1.0, 10.0];
numberOfStepForColor = [30, 40, 40, 30, 36];
startValueForColor = [104000.0, 263.15, 263.15, 0.0, 0.0];
startColor = ['blue', 'blue', 'blue', 'blue', 'red'];
hslHueAngle = [-300, -300, -300, -300, -360];
datasetCategoryPathConfigMap.set(categoryPath, {name:name, filter:filter, height:height, stepValueForColor:stepValueForColor, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/upper_air/drop_sonde/';
height = ['geopotential height [m]'];
name = ['pressure [Pa]', 'air temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]', 'wind direction [degree]'];
stepValueForColor = [-400.0, 1.0, 1.0, 1.0, 10.0];
numberOfStepForColor = [30, 40, 40, 30, 36];
startValueForColor = [104000.0, 263.15, 263.15, 0.0, 0.0];
startColor = ['blue', 'blue', 'blue', 'blue', 'red'];
hslHueAngle = [-300, -300, -300, -300, -360];
datasetCategoryPathConfigMap.set(categoryPath, {name:name, filter:filter, height:height, stepValueForColor:stepValueForColor, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/satellite/amsua/';
height = [];
name = ['brightness temperature [K](channel=1)', 'brightness temperature [K](channel=2)', 'brightness temperature [K](channel=13)', 'brightness temperature [K](channel=14)'];
stepValueForColor = [1.0, 1.0, 1.0, 1.0];
numberOfStepForColor = [60, 60, 60, 60];
startValueForColor = [153.15, 153.15, 233.15, 233.15];
startColor = ['blue', 'blue', 'blue', 'blue'];
hslHueAngle = [-300, -300, -300, -300];
datasetCategoryPathConfigMap.set(categoryPath, {name:name, filter:filter, height:height, stepValueForColor:stepValueForColor, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/satellite/csr/';
height = [];
name = ['brightness temperature [K](channel=1)', 'brightness temperature [K](channel=2)', 'brightness temperature [K](channel=9)', 'brightness temperature [K](channel=10)'];
stepValueForColor = [1.0, 1.0, 1.0, 1.0];
numberOfStepForColor = [40, 40, 40, 40];
startValueForColor = [263.15, 223.15, 263.15, 253.15];
startColor = ['blue', 'blue', 'blue', 'blue'];
hslHueAngle = [-300, -300, -300, -300];
datasetCategoryPathConfigMap.set(categoryPath, {name:name, filter:filter, height:height, stepValueForColor:stepValueForColor, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/satellite/atms/';
height = [];
name = ['brightness temperature [K](channel=1)', 'brightness temperature [K](channel=2)', 'brightness temperature [K](channel=13)', 'brightness temperature [K](channel=14)'];
stepValueForColor = [1.0, 1.0, 1.0, 1.0];
numberOfStepForColor = [60, 60, 60, 60];
startValueForColor = [153.15, 153.15, 233.15, 233.15];
startColor = ['blue', 'blue', 'blue', 'blue'];
hslHueAngle = [-300, -300, -300, -300];
datasetCategoryPathConfigMap.set(categoryPath, {name:name, filter:filter, height:height, stepValueForColor:stepValueForColor, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/satellite/cris/';
height = [];
name = ['brightness temperature [K](channel=1)', 'brightness temperature [K](channel=2)', 'brightness temperature [K](channel=9)', 'brightness temperature [K](channel=10)'];
stepValueForColor = [1.0, 1.0, 1.0, 1.0];
numberOfStepForColor = [40, 40, 40, 40];
startValueForColor = [263.15, 223.15, 263.15, 253.15];
startColor = ['blue', 'blue', 'blue', 'blue'];
hslHueAngle = [-300, -300, -300, -300];
datasetCategoryPathConfigMap.set(categoryPath, {name:name, filter:filter, height:height, stepValueForColor:stepValueForColor, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

</script>
<style>
.table {width:100%;}
.tr {display:table;}
.td {display:table-cell;}
.deckglViewerHeader {width:360px;padding:1px;}
.deckglViewerBig {height:520px;width:520px;padding:1px;border:1px dotted;}
.deckglViewerSmall {height:360px;width:360px;padding:1px;border:1px dotted;}
.deckglViewerFooter {width:360px;padding:1px;}
perspective-viewer {height:520px;width:1040px;}
</style>
</head>
<body>
<div><select id='category0'></select><select id='category1'></select><select id='category2'></select><select id='category3'></select><select id='datetime0'></select><select id='datetime1'></select><select id='datetime2'></select><select id='viewerType'><option>Map</option><option>Globe</option></select><select id='layerType'><option>PointCloud</option><!-- <option>PointCloud(threshold)</option><option>ScreenGrid(sum points)</option> --></select></div>
<div id='perspectiveViewer'><perspective-viewer class='perspective-viewer-material' editable></perspective-viewer></div>
<div claas='table' id='deckglViewers'></div>
</body>
</html>
