<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'>
<title>meteorological visualizer</title>
<link href='https://unpkg.com/cesium@1.87.1/Build/Cesium/Widgets/widgets.css' rel='stylesheet'>
<link href='https://cdn.jsdelivr.net/npm/cesium@1.87.1/Build/Cesium/Widgets/widgets.css' rel='stylesheet'>
<script src='https://unpkg.com/cesium@1.87.1/Build/Cesium/Cesium.js'></script>
<script src='https://cdn.jsdelivr.net/npm/cesium@1.87.1/Build/Cesium/Cesium.js'></script>
<script src='https://unpkg.com/d3@7.1.1/dist/d3.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/d3@7.1.1/dist/d3.min.js'></script>
<script src='https://unpkg.com/d3-tricontour@1.0.2/dist/d3-tricontour.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/d3-tricontour@1.0.2/dist/d3-tricontour.min.js'></script>
<script src='https://unpkg.com/apache-arrow@6.0.1/Arrow.es2015.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/apache-arrow@6.0.1/Arrow.es2015.min.js'></script>
<script src='https://unpkg.com/aws-sdk@2.1037.0/dist/aws-sdk.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/aws-sdk@2.1037.0/dist/aws-sdk.min.js'></script>
<script type='module' src='./js/meteorological_visualizer.js'></script>
<script>
const percentageChanged = 0.001, resolutionScale = 1.0, controleViewerId = 'controleViewer';
const mapImageryProvider = new Cesium.OpenStreetMapImageryProvider({url:'https://cyberjapandata.gsi.go.jp/xyz/std/'}), mapCopyRight = "地図の出典:<a href='https://maps.gsi.go.jp/development/ichiran.html'>国土地理院</a>";
//const mapImageryProvider = new Cesium.OpenStreetMapImageryProvider({url:'https://cyberjapandata.gsi.go.jp/xyz/earthhillshade/'}), mapCopyRight = "地図の出典:<a href='https://maps.gsi.go.jp/development/ichiran.html'>国土地理院</a>";
//const mapImageryProvider = new Cesium.OpenStreetMapImageryProvider({url:'https://tile.openstreetmap.org/'}), mapCopyRight = 'Base map:© OpenStreetMap contributors';
const sceneMode2D = Cesium.SceneMode.SCENE2D, initialHeight2D = 40400000, maximumZoomDistance2D = 40400000, minimumZoomDistance2D = 5000000;
const sceneMode2p5D = Cesium.SceneMode.COLUMBUS_VIEW, initialHeight2p5D = 40400000, maximumZoomDistance2p5D = 40400000, minimumZoomDistance2p5D = 5000000;
const sceneMode3D = Cesium.SceneMode.SCENE3D, initialHeight3D = 6500000, maximumZoomDistance3D = 6500000, minimumZoomDistance3D = 3500000;
const endpoint = 'http://202.32.195.138:9000/', bucket = 'aa-open-dataset', datasetRootPath = '1MinuteDataset/', urlSuffix = 'all.arrow';
const initialLatitude = 36, initialLongitude = 140;
var sceneMode = sceneMode2D, initialHeight = initialHeight2D, maximumZoomDistance = maximumZoomDistance2D, minimumZoomDistance = minimumZoomDistance2D;
var s3 = new AWS.S3({endpoint: new AWS.Endpoint(endpoint), s3ForcePathStyle: true});
var configTableMap = new Map([]);
var numberOfViewerMap = new Map([]);
var numberOfViewersTableTd = 2;
let categoryPath, name, draw, thresholdStart, thresholdEnd, numberOfStepForColor, startColor, hslHueAngle, size, configTable;

categoryPath = 'bufr_to_arrow/ocean/float/'
name = Arrow.Utf8Vector.from(['water pressure [Pa]']);
draw = Arrow.Utf8Vector.from(['point']);
thresholdStart = Arrow.Float32Vector.from([0.0]);
thresholdEnd = Arrow.Float32Vector.from([20000000.0]);
thresholdStep = Arrow.Float32Vector.from([1000000.0]);
numberOfStepForColor = Arrow.Uint8Vector.from([20]);
startValueForColor = Arrow.Float32Vector.from([0.0]);
startColor = Arrow.Utf8Vector.from(['blue']);
hslHueAngle = Arrow.Int16Vector.from([-300]);
size = Arrow.Uint8Vector.from([4]);
configTable = Arrow.Table.new({name:name, draw:draw, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle, size:size});
configTableMap.set(datasetRootPath + categoryPath, configTable);
numberOfViewerMap.set(datasetRootPath + categoryPath, 1);

categoryPath = 'bufr_to_arrow/surface/buoy/'
name = Arrow.Utf8Vector.from(['pressure reduced to mean sea level [Pa]', 'air temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]']);
draw = Arrow.Utf8Vector.from(['point', 'point', 'point', 'point']);
thresholdStart = Arrow.Float32Vector.from([120000.0, 253.15, 253.15, 0.0]);
thresholdEnd = Arrow.Float32Vector.from([80000.0, 313.15, 313.15, 30.0]);
thresholdStep = Arrow.Float32Vector.from([-400.0, 1.0, 1.0, 1.0]);
numberOfStepForColor = Arrow.Uint8Vector.from([30, 40, 40, 30]);
startValueForColor = Arrow.Float32Vector.from([104000.0, 263.15, 263.15, 0.0]);
startColor = Arrow.Utf8Vector.from(['blue', 'blue', 'blue', 'blue']);
hslHueAngle = Arrow.Int16Vector.from([-300, -300, -300, -300]);
size = Arrow.Uint8Vector.from([4, 4, 4, 4]);
configTable = Arrow.Table.new({name:name, draw:draw, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle, size:size});
configTableMap.set(datasetRootPath + categoryPath, configTable);
numberOfViewerMap.set(datasetRootPath + categoryPath, 4);

categoryPath = 'bufr_to_arrow/surface/gps_pwv/'
name = Arrow.Utf8Vector.from(['atmospheric path delay in satellite signal [m]']);
draw = Arrow.Utf8Vector.from(['point']);
thresholdStart = Arrow.Float32Vector.from([1.0]);
thresholdEnd = Arrow.Float32Vector.from([3.0]);
thresholdStep = Arrow.Float32Vector.from([0.05]);
numberOfStepForColor = Arrow.Uint8Vector.from([40]);
startValueForColor = Arrow.Float32Vector.from([1.0]);
startColor = Arrow.Utf8Vector.from(['blue']);
hslHueAngle = Arrow.Int16Vector.from([-300]);
size = Arrow.Uint8Vector.from([4]);
configTable = Arrow.Table.new({name:name, draw:draw, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle, size:size});
configTableMap.set(datasetRootPath + categoryPath, configTable);
numberOfViewerMap.set(datasetRootPath + categoryPath, 1);

categoryPath = 'bufr_to_arrow/surface/ship/'
name = Arrow.Utf8Vector.from(['pressure reduced to mean sea level [Pa]', 'air temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]']);
draw = Arrow.Utf8Vector.from(['point', 'point', 'point', 'point']);
thresholdStart = Arrow.Float32Vector.from([120000.0, 253.15, 253.15, 0.0]);
thresholdEnd = Arrow.Float32Vector.from([80000.0, 313.15, 313.15, 30.0]);
thresholdStep = Arrow.Float32Vector.from([-400.0, 1.0, 1.0, 1.0]);
numberOfStepForColor = Arrow.Uint8Vector.from([30, 40, 40, 30]);
startValueForColor = Arrow.Float32Vector.from([104000.0, 263.15, 263.15, 0.0]);
startColor = Arrow.Utf8Vector.from(['blue', 'blue', 'blue', 'blue']);
hslHueAngle = Arrow.Int16Vector.from([-300, -300, -300, -300]);
size = Arrow.Uint8Vector.from([4, 4, 4, 4]);
configTable = Arrow.Table.new({name:name, draw:draw, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle, size:size});
configTableMap.set(datasetRootPath + categoryPath, configTable);
numberOfViewerMap.set(datasetRootPath + categoryPath, 4);

categoryPath = 'bufr_to_arrow/surface/synop/'
name = Arrow.Utf8Vector.from(['pressure reduced to mean sea level [Pa]', 'air temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]']);
draw = Arrow.Utf8Vector.from(['point', 'point', 'point', 'point']);
thresholdStart = Arrow.Float32Vector.from([120000.0, 253.15, 253.15, 0.0]);
thresholdEnd = Arrow.Float32Vector.from([80000.0, 313.15, 313.15, 30.0]);
thresholdStep = Arrow.Float32Vector.from([-400.0, 1.0, 1.0, 1.0]);
numberOfStepForColor = Arrow.Uint8Vector.from([30, 40, 40, 30]);
startValueForColor = Arrow.Float32Vector.from([104000.0, 263.15, 263.15, 0.0]);
startColor = Arrow.Utf8Vector.from(['blue', 'blue', 'blue', 'blue']);
hslHueAngle = Arrow.Int16Vector.from([-300, -300, -300, -300]);
size = Arrow.Uint8Vector.from([4, 4, 4, 4]);
configTable = Arrow.Table.new({name:name, draw:draw, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle, size:size});
configTableMap.set(datasetRootPath + categoryPath, configTable);
numberOfViewerMap.set(datasetRootPath + categoryPath, 4);

categoryPath = 'bufr_to_arrow/upper_air/aircraft/'
name = Arrow.Utf8Vector.from(['flight level [m]', 'air temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]']);
draw = Arrow.Utf8Vector.from(['point', 'point', 'point', 'point']);
thresholdStart = Arrow.Float32Vector.from([0.0, 253.15, 253.15, 0.0]);
thresholdEnd = Arrow.Float32Vector.from([10000.0, 313.15, 313.15, 30.0]);
thresholdStep = Arrow.Float32Vector.from([400.0, 1.0, 1.0, 1.0]);
numberOfStepForColor = Arrow.Uint8Vector.from([40, 40, 40, 30]);
startValueForColor = Arrow.Float32Vector.from([400.0, 263.15, 263.15, 0.0]);
startColor = Arrow.Utf8Vector.from(['blue', 'blue', 'blue', 'blue']);
hslHueAngle = Arrow.Int16Vector.from([-300, -300, -300, -300]);
size = Arrow.Uint8Vector.from([4, 4, 4, 4]);
configTable = Arrow.Table.new({name:name, draw:draw, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle, size:size});
configTableMap.set(datasetRootPath + categoryPath, configTable);
numberOfViewerMap.set(datasetRootPath + categoryPath, 4);

categoryPath = 'bufr_to_arrow/upper_air/profiler/'
name = Arrow.Utf8Vector.from(['height [m]', 'virtual temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]']);
draw = Arrow.Utf8Vector.from(['point', 'point', 'point', 'point']);
thresholdStart = Arrow.Float32Vector.from([0.0, 253.15, 253.15, 0.0]);
thresholdEnd = Arrow.Float32Vector.from([10000.0, 313.15, 313.15, 30.0]);
thresholdStep = Arrow.Float32Vector.from([400.0, 1.0, 1.0, 1.0]);
numberOfStepForColor = Arrow.Uint8Vector.from([40, 40, 40, 30]);
startValueForColor = Arrow.Float32Vector.from([400.0, 263.15, 263.15, 0.0]);
startColor = Arrow.Utf8Vector.from(['blue', 'blue', 'blue', 'blue']);
hslHueAngle = Arrow.Int16Vector.from([-300, -300, -300, -300]);
size = Arrow.Uint8Vector.from([4, 4, 4, 4]);
configTable = Arrow.Table.new({name:name, draw:draw, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle, size:size});
configTableMap.set(datasetRootPath + categoryPath, configTable);
numberOfViewerMap.set(datasetRootPath + categoryPath, 4);

categoryPath = 'bufr_to_arrow/upper_air/sonde/'
name = Arrow.Utf8Vector.from(['pressure [Pa]', 'air temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]']);
draw = Arrow.Utf8Vector.from(['point', 'point', 'point', 'point']);
thresholdStart = Arrow.Float32Vector.from([120000.0, 253.15, 253.15, 0.0]);
thresholdEnd = Arrow.Float32Vector.from([80000.0, 313.15, 313.15, 30.0]);
thresholdStep = Arrow.Float32Vector.from([-400.0, 1.0, 1.0, 1.0]);
numberOfStepForColor = Arrow.Uint8Vector.from([30, 40, 40, 30]);
startValueForColor = Arrow.Float32Vector.from([104000.0, 263.15, 263.15, 0.0]);
startColor = Arrow.Utf8Vector.from(['blue', 'blue', 'blue', 'blue']);
hslHueAngle = Arrow.Int16Vector.from([-300, -300, -300, -300]);
size = Arrow.Uint8Vector.from([4, 4, 4, 4]);
configTable = Arrow.Table.new({name:name, draw:draw, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle, size:size});
configTableMap.set(datasetRootPath + categoryPath, configTable);
numberOfViewerMap.set(datasetRootPath + categoryPath, 4);

</script>
<style>
.table {width:100%;}
.tr {display:table;}
.td {display:table-cell;}
.viewerheader {width:360px;padding:1px;}
.viewerbig {height:360px;width:360px;padding:1px;}
.viewersmall {height:180px;width:360px;padding:1px;}
.viewerfooter {width:360px;padding:1px;}
</style>
</head>
<body>
<div><select id='sceneMode'><option selected>2D</option><option>2.5D</option><option>3D</option></select><select id='category0'></select><select id='category1'></select><select id='category2'></select><select id='datetime0'></select><select id='datetime1'></select><select id='datetime2'></select></div>
<div claas='table' id='viewers'></div>
<div style='visibility:hidden' id='controleViewer'></div>
<div style='visibility:hidden' id='c'></div>
</body>
</html>
