<!doctype html>
<html>
<head>
<meta charset='UTF-8'>
<title>Perspetive deck.gl viewer</title>
<link href='https://unpkg.com/@finos/perspective-viewer@1.0.5/dist/umd/material-dense.css' rel='stylesheet'/>
<link href='https://cdn.jsdelivr.net/npm/@finos/perspective-viewer@1.0.5/dist/umd/material-dense.css' rel='stylesheet'/>
<script src='https://unpkg.com/@finos/perspective@1.0.5/dist/umd/perspective.js'></script>
<script src='https://cdn.jsdelivr.net/npm/@finos/perspective@1.0.5/dist/umd/perspective.js'></script>
<script src='https://unpkg.com/@finos/perspective-viewer@1.0.5/dist/umd/perspective-viewer.js'></script>
<script src='https://cdn.jsdelivr.net/npm/@finos/perspective-viewer@1.0.5/dist/umd/perspective-viewer.js'></script>
<script src='https://unpkg.com/@finos/perspective-viewer-datagrid@1.0.5/dist/umd/perspective-viewer-datagrid.js'></script>
<!-- <script src='https://cdn.jsdelivr.net/npm/@finos/perspective-viewer-datagrid@1.0.5/dist/umd/perspective-viewer-datagrid.js'></script> -->
<script src='https://unpkg.com/@finos/perspective-viewer-d3fc@1.0.5/dist/umd/perspective-viewer-d3fc.js'></script>
<!-- <script src='https://cdn.jsdelivr.net/npm/@finos/perspective-viewer-d3fc@1.0.5/dist/umd/perspective-viewer-d3fc.js'></script> -->
<script src='https://unpkg.com/deck.gl@8.6.5/dist.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/deck.gl@8.6.5/dist.min.js'></script>
<script src='https://unpkg.com/aws-sdk@2.1037.0/dist/aws-sdk.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/aws-sdk@2.1037.0/dist/aws-sdk.min.js'></script>
<script src='https://unpkg.com/d3@7.1.1/dist/d3.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/d3@7.1.1/dist/d3.min.js'></script>
<script src='https://unpkg.com/d3-tricontour@1.0.2/dist/d3-tricontour.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/d3-tricontour@1.0.2/dist/d3-tricontour.min.js'></script>
<script type='module' src='./js/PerspectiveDeckgl.js'></script>
<script>
const mapGeoJsonLayer = new deck.GeoJsonLayer({data:'js/ne_110m_coastline.json',stroked:true,filled:true,lineWidthMinPixels:2,opacity:0.4,getLineColor:[60, 60, 60],getFillColor:[200, 200, 200]});
const endpoint = 'http://202.32.195.138:9000/', bucket = 'aa-open-dataset', datasetRootPath = '1MinuteDataset/', urlSuffix = '.arrow';
const mapViewInitialViewState = {latitude:0.0,longitude:0.0,zoom:0,bearing:0,pitch:0};
const globeViewInitialViewState = {latitude:35.0,longitude:140.0,zoom:0,bearing:0,pitch:0};
const s3 = new AWS.S3({endpoint: new AWS.Endpoint(endpoint), s3ForcePathStyle: true});
const numberOfConfigDeckglViewersTableTd = 2;
let datasetCategoryPathConfigColumnsMap = new Map([]);
let categoryPath, name, height, thresholdStart, thresholdEnd, numberOfStepForColor, startColor, hslHueAngle, configTable;

categoryPath = 'bufr_to_arrow/ocean/float/all/';
height = ['water pressure [Pa]'];
//filter = ['1/0/0.arrow', '1/0/1.arrow', '1/1/0.arrow', '1/1/1.arrow', '1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
filter = ['1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
name = ['water pressure [Pa]'];
thresholdStart = [0.0];
thresholdEnd = [20000000.0];
thresholdStep = [1000000.0];
numberOfStepForColor = [20];
startValueForColor = [0.0];
startColor = ['blue'];
hslHueAngle = [-300];
datasetCategoryPathConfigColumnsMap.set(datasetRootPath + categoryPath, {name:name, filter:filter, height:height, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/surface/buoy/all/';
height = [];
//filter = ['1/0/0.arrow', '1/0/1.arrow', '1/1/0.arrow', '1/1/1.arrow', '1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
filter = ['1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
name = ['pressure reduced to mean sea level [Pa]', 'oceanographic water temperature [K]', 'wind speed [m s-1]', 'wind direction [degree]'];
thresholdStart = [120000.0, 253.15, 0.0, 0.0];
thresholdEnd = [80000.0, 313.15, 30.0, 360.0];
thresholdStep = [-400.0, 1.0, 1.0, 10.0];
numberOfStepForColor = [30, 40, 30, 36];
startValueForColor = [104000.0, 263.15, 0.0, 0.0];
startColor = ['blue', 'blue', 'blue', 'red'];
hslHueAngle = [-300, -300, -300, -360];
datasetCategoryPathConfigColumnsMap.set(datasetRootPath + categoryPath, {name:name, filter:filter, height:height, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/surface/gps_station/all/';
height = ['height of station [m]'];
//filter = ['1/0/0.arrow', '1/0/1.arrow', '1/1/0.arrow', '1/1/1.arrow', '1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
filter = ['1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
name = ['atmospheric path delay in satellite signal [m]'];
thresholdStart = [1.0];
thresholdEnd = [3.0];
thresholdStep = [0.05];
numberOfStepForColor = [40];
startValueForColor = [1.0];
startColor = ['blue'];
hslHueAngle = [-300];
datasetCategoryPathConfigColumnsMap.set(datasetRootPath + categoryPath, {name:name, filter:filter, height:height, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/surface/ship/all/';
height = [];
//filter = ['1/0/0.arrow', '1/0/1.arrow', '1/1/0.arrow', '1/1/1.arrow', '1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
filter = ['1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
name = ['pressure reduced to mean sea level [Pa]', 'air temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]', 'wind direction [degree]'];
thresholdStart = [120000.0, 253.15, 253.15, 0.0, 0.0];
thresholdEnd = [80000.0, 313.15, 313.15, 30.0, 360.0];
thresholdStep = [-400.0, 1.0, 1.0, 1.0, 10.0];
numberOfStepForColor = [30, 40, 40, 30, 36];
startValueForColor = [104000.0, 263.15, 263.15, 0.0, 0.0];
startColor = ['blue', 'blue', 'blue', 'blue', 'red'];
hslHueAngle = [-300, -300, -300, -300, -360];
datasetCategoryPathConfigColumnsMap.set(datasetRootPath + categoryPath, {name:name, filter:filter, height:height, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/surface/weather_station/all/';
height = ['height of station [m]'];
//filter = ['1/0/0.arrow', '1/0/1.arrow', '1/1/0.arrow', '1/1/1.arrow', '1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
filter = ['1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
name = ['pressure reduced to mean sea level [Pa]', 'air temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]', 'wind direction [degree]'];
thresholdStart = [120000.0, 253.15, 253.15, 0.0, 0.0];
thresholdEnd = [80000.0, 313.15, 313.15, 30.0, 360.0];
thresholdStep = [-400.0, 1.0, 1.0, 1.0, 10.0];
numberOfStepForColor = [30, 40, 40, 30, 36];
startValueForColor = [104000.0, 263.15, 263.15, 0.0, 0.0];
startColor = ['blue', 'blue', 'blue', 'blue', 'red'];
hslHueAngle = [-300, -300, -300, -300, -360];
datasetCategoryPathConfigColumnsMap.set(datasetRootPath + categoryPath, {name:name, filter:filter, height:height, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/upper_air/aircraft/all/';
height = ['flight level [m]' , 'height [m]'];
//filter = ['1/0/0.arrow', '1/0/1.arrow', '1/1/0.arrow', '1/1/1.arrow', '1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
filter = ['1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
name = ['flight level [m]', 'air temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]', 'wind direction [degree]'];
thresholdStart = [0.0, 253.15, 253.15, 0.0, 0.0];
thresholdEnd = [10000.0, 313.15, 313.15, 30.0, 360.0];
thresholdStep = [400.0, 1.0, 1.0, 1.0, 10.0];
numberOfStepForColor = [40, 40, 40, 30, 36];
startValueForColor = [400.0, 263.15, 263.15, 0.0, 0.0];
startColor = ['blue', 'blue', 'blue', 'blue', 'red'];
hslHueAngle = [-300, -300, -300, -300, -360];
datasetCategoryPathConfigColumnsMap.set(datasetRootPath + categoryPath, {name:name, filter:filter, height:height, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/upper_air/profiler/all/';
height = ['height [m]'];
//filter = ['1/0/0.arrow', '1/0/1.arrow', '1/1/0.arrow', '1/1/1.arrow', '1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
filter = ['1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
name = ['height [m]', 'virtual temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]', 'wind direction [degree]'];
thresholdStart = [0.0, 253.15, 253.15, 0.0, 0.0];
thresholdEnd = [10000.0, 313.15, 313.15, 30.0, 360.0];
thresholdStep = [400.0, 1.0, 1.0, 1.0, 10.0];
numberOfStepForColor = [40, 40, 40, 30, 36];
startValueForColor = [400.0, 263.15, 263.15, 0.0, 0.0];
startColor = ['blue', 'blue', 'blue', 'blue', 'red'];
hslHueAngle = [-300, -300, -300, -300, -360];
datasetCategoryPathConfigColumnsMap.set(datasetRootPath + categoryPath, {name:name, filter:filter, height:height, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/upper_air/sonde/all/';
height = ['geopotential height [m]'];
//filter = ['1/0/0.arrow', '1/0/1.arrow', '1/1/0.arrow', '1/1/1.arrow', '1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
filter = ['1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
name = ['pressure [Pa]', 'air temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]', 'wind direction [degree]'];
thresholdStart = [120000.0, 253.15, 253.15, 0.0, 0.0];
thresholdEnd = [80000.0, 313.15, 313.15, 30.0, 360.0];
thresholdStep = [-400.0, 1.0, 1.0, 1.0, 10.0];
numberOfStepForColor = [30, 40, 40, 30, 36];
startValueForColor = [104000.0, 263.15, 263.15, 0.0, 0.0];
startColor = ['blue', 'blue', 'blue', 'blue', 'red'];
hslHueAngle = [-300, -300, -300, -300, -360];
datasetCategoryPathConfigColumnsMap.set(datasetRootPath + categoryPath, {name:name, filter:filter, height:height, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

categoryPath = 'bufr_to_arrow/upper_air/drop_sonde/all/';
height = ['geopotential height [m]'];
//filter = ['1/0/0.arrow', '1/0/1.arrow', '1/1/0.arrow', '1/1/1.arrow', '1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
filter = ['1/2/0.arrow', '1/2/1.arrow', '1/3/0.arrow', '1/3/1.arrow'];
name = ['pressure [Pa]', 'air temperature [K]', 'dewpoint temperature [K]', 'wind speed [m s-1]', 'wind direction [degree]'];
thresholdStart = [120000.0, 253.15, 253.15, 0.0, 0.0];
thresholdEnd = [80000.0, 313.15, 313.15, 30.0, 360.0];
thresholdStep = [-400.0, 1.0, 1.0, 1.0, 10.0];
numberOfStepForColor = [30, 40, 40, 30, 36];
startValueForColor = [104000.0, 263.15, 263.15, 0.0, 0.0];
startColor = ['blue', 'blue', 'blue', 'blue', 'red'];
hslHueAngle = [-300, -300, -300, -300, -360];
datasetCategoryPathConfigColumnsMap.set(datasetRootPath + categoryPath, {name:name, filter:filter, height:height, thresholdStart:thresholdStart, thresholdEnd:thresholdEnd, thresholdStep:thresholdStep, numberOfStepForColor:numberOfStepForColor, startValueForColor:startValueForColor, startColor:startColor, hslHueAngle:hslHueAngle});

</script>
<style>
.table {width:100%;}
.tr {display:table;}
.td {display:table-cell;}
.deckglViewerHeader {width:360px;padding:1px;}
.deckglViewerBig {height:520px;width:520px;padding:1px;border:1px dotted;}
.deckglViewerSmall {height:360px;width:360px;padding:1px;border:1px dotted;}
.deckglViewerFooter {width:360px;padding:1px;}
perspective-viewer {position:absolute;top:36px;left:0;right:0;bottom:0;visibility:hidden}
</style>
</head>
<body>
<div><select id='viewerType'><option>Map</option><option>Globe</option><option>Table</option></select><select id='layerType'><option>PointCloud</option><!-- <option>Contour</option><option>ScreenGrid(max)</option><option>ScreenGrid(min)</option><option>ScreenGrid(sum points)</option>--></select><select id='category0'></select><select id='category1'></select><select id='category2'></select><select id='category3'></select><select id='datetime0'></select><select id='datetime1'></select><select id='datetime2'></select><select id='tileLevel'></select> <select id="tileXY" multiple='multiple' size='1'></select></div>
<div claas='table' id='deckglViewers'></div>
<div id='perspectiveViewer'><perspective-viewer class='perspective-viewer-material' editable></perspective-viewer></div>
</body>
</html>
